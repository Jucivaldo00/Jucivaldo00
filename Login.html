<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | Juciloja</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Estilos básicos (adicione seu Login.css completo aqui) */
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #71b7e6, #9b59b6);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      padding: 0;
    }
    
    .wrapper {
      width: 400px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    }
    
    h2 {
      color: #fff;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .input-field {
      position: relative;
      margin-bottom: 25px;
    }
    
    .input-field input {
      width: 100%;
      padding: 10px;
      background: transparent;
      border: none;
      border-bottom: 1px solid #fff;
      color: #fff;
      font-size: 16px;
      outline: none;
    }
    
    .input-field label {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      pointer-events: none;
      transition: 0.3s;
    }
    
    .input-field input:focus ~ label,
    .input-field input:valid ~ label {
      top: -15px;
      font-size: 12px;
      color: #e2e2e2;
    }
    
    .password-container {
      position: relative;
    }
    
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #fff;
      cursor: pointer;
    }
    
    .forget {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      color: #fff;
      font-size: 14px;
    }
    
    .forget label {
      display: flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
    }
    
    .forget a {
      color: #fff;
      text-decoration: none;
    }
    
    .forget a:hover {
      text-decoration: underline;
    }
    
    button {
      width: 100%;
      padding: 12px;
      background: #fff;
      border: none;
      border-radius: 5px;
      color: #333;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 20px;
      transition: 0.3s;
    }
    
    button:hover {
      background: #f0f0f0;
    }
    
    .google-btn {
      background: #4285F4;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .google-btn:hover {
      background: #357ae8;
    }
    
    .register {
      text-align: center;
      color: #fff;
      font-size: 14px;
    }
    
    .register a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }
    
    .register a:hover {
      text-decoration: underline;
    }
    
    .divider {
      display: flex;
      align-items: center;
      margin: 20px 0;
      color: #fff;
    }
    
    .divider::before,
    .divider::after {
      content: "";
      flex: 1;
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .divider-text {
      padding: 0 10px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <form action="#">
      <h2>Login</h2>
      <div class="input-field">
        <input type="text" id="email" required autocomplete="username">
        <label>Digite o e-mail</label>
      </div>
      <div class="input-field password-container">
        <input type="password" id="password" required autocomplete="current-password">
        <label>Digite a senha</label>
        <i class="toggle-password fas fa-eye" id="togglePassword"></i>
      </div>
      <div class="forget">
        <label for="remember">
          <input type="checkbox" id="remember" checked>
          <p>Lembrar-me</p>
        </label>
        <a href="#" id="forgotPassword">Esqueceu a senha?</a>
      </div>
      <button type="submit">Entrar</button>
      
      <div class="divider">
        <span class="divider-text">OU</span>
      </div>
      
      <button type="button" class="google-btn" id="googleLogin">
        <i class="fab fa-google"></i> Entrar com Google
      </button>
      
      <div class="register">
        <a href="Home.html" id="skip-login">Acessar sem login</a>
      </div>
      <div class="register">
        <p>Não possui conta? <a href="Cadastra.html">Registrar-se</a></p>
      </div>
    </form>
  </div>

  <!-- Firebase SDK v9 (modular) -->
  <script type="module">
    // Importações do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      signInWithPopup, 
      GoogleAuthProvider,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    // Configuração do Firebase para o projeto Juciloja
    const firebaseConfig = {
      apiKey: "AIzaSyDeydDlOVXSAIiatAJldHv1OOXQpHAmSUw",
      authDomain: "juciloja.firebaseapp.com",
      projectId: "juciloja",
      storageBucket: "juciloja.appspot.com",
      messagingSenderId: "560206416707",
      appId: "1:560206416707:web:98c7d4ff8bfc3e297bbdf6",
      measurementId: "G-MB1LJDK3G3"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Elementos do DOM
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const rememberCheckbox = document.getElementById('remember');
    const togglePassword = document.getElementById('togglePassword');
    const forgotPasswordLink = document.getElementById('forgotPassword');
    const googleLoginBtn = document.getElementById('googleLogin');
    const loginForm = document.querySelector('form');

    // Mostrar/ocultar senha
    togglePassword.addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.classList.toggle('fa-eye-slash');
    });

    // Recuperação de senha
    forgotPasswordLink.addEventListener('click', (e) => {
      e.preventDefault();
      const email = prompt("Digite seu e-mail para redefinir a senha:");
      
      if (email) {
        sendPasswordResetEmail(auth, email)
          .then(() => {
            alert(`E-mail de redefinição enviado para ${email}. Verifique sua caixa de entrada.`);
          })
          .catch((error) => {
            alert("Erro ao enviar e-mail de redefinição: " + error.message);
          });
      }
    });

    // Login com e-mail/senha
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();

      const email = emailInput.value;
      const password = passwordInput.value;
      const rememberMe = rememberCheckbox.checked;

      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          
          // Salvar credenciais se "Lembrar-me" estiver marcado
          if (rememberMe) {
            localStorage.setItem('rememberedEmail', email);
            // Nota: Nunca armazene senhas no localStorage por questões de segurança
          } else {
            localStorage.removeItem('rememberedEmail');
          }

          // Salvar dados do usuário
          localStorage.setItem('user', JSON.stringify({
            uid: user.uid,
            email: user.email,
            displayName: user.displayName || "Usuário",
            photoURL: user.photoURL || "https://via.placeholder.com/150"
          }));

          window.location.href = "Home.html";
        })
        .catch((error) => {
          let errorMessage = "Erro no login: ";
          switch (error.code) {
            case "auth/invalid-email":
              errorMessage += "E-mail inválido.";
              break;
            case "auth/user-disabled":
              errorMessage += "Esta conta foi desativada.";
              break;
            case "auth/user-not-found":
              errorMessage += "Usuário não encontrado.";
              break;
            case "auth/wrong-password":
              errorMessage += "Senha incorreta.";
              break;
            default:
              errorMessage += error.message;
          }
          alert(errorMessage);
        });
    });

    // Login com Google
    googleLoginBtn.addEventListener('click', () => {
      signInWithPopup(auth, provider)
        .then((result) => {
          const user = result.user;
          
          localStorage.setItem('user', JSON.stringify({
            uid: user.uid,
            email: user.email,
            displayName: user.displayName,
            photoURL: user.photoURL
          }));

          window.location.href = "Home.html";
        })
        .catch((error) => {
          alert("Erro ao fazer login com Google: " + error.message);
        });
    });

    // Preencher e-mail lembrado ao carregar a página
    window.addEventListener('DOMContentLoaded', () => {
      const rememberedEmail = localStorage.getItem('rememberedEmail');
      if (rememberedEmail) {
        emailInput.value = rememberedEmail;
        rememberCheckbox.checked = true;
        passwordInput.focus();
      }
    });
  </script>

  <script>
    // Ao clicar em "Acessar sem login", remove o user salvo
    document.getElementById('skip-login').addEventListener('click', () => {
      localStorage.removeItem('user');
    });
  </script>
</body>
</html>