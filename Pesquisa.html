<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa - NΞMΞSIS</title>
    <link rel="stylesheet" href="Home.css">
    <!-- Fontes do Google -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0">
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar (copie o mesmo da Home.html) -->
        <!-- Sidebar -->
    <aside class="sidebar">
        <header class="sidebar-header">
            <a href="#" class="header-logo">
                <img src="logo.jpg" alt="NΞMΞSIS">
            </a>
            <button class="sidebar-toggler">
                <span class="material-symbols-rounded">chevron_left</span>
            </button>
        </header>

        <nav class="sidebar-nav">
            <ul class="nav-list primary-nav">
                <!-- Item de Pesquisa -->
                <li class="nav-item">
                    <a href="Home.html" class="nav-link">
                        <span class="material-symbols-rounded">home</span>
                        <span class="nav-label">HOME</span>
                    </a>
                </li>

                <!-- Menu de Categorias -->
                <li class="nav-item dropdown-container">
                    <a href="#" class="nav-link dropdown-toggle">
                        <span class="material-symbols-rounded">category</span>
                        <span class="nav-label">Categorias</span>
                        <span class="dropdown-icon material-symbols-rounded">keyboard_arrow_down</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="nav-item"><a class="nav-link dropdown-title">Categorias</a></li>
                        <li class="nav-item"><a href="#" class="nav-link dropdown-link" data-category="maquiagem">Maquiagem</a></li>
                        <li class="nav-item"><a href="#" class="nav-link dropdown-link" data-category="skincare">Skincare</a></li>
                        <li class="nav-item"><a href="#" class="nav-link dropdown-link" data-category="cabelos">Cabelos</a></li>
                        <li class="nav-item"><a href="#" class="nav-link dropdown-link" data-category="perfumes">Perfumes</a></li>
                        <li class="nav-item"><a href="#" class="nav-link dropdown-link" data-category="corpo">Corpo e Banho</a></li>
                    </ul>
                </li>

                <!-- Notificações -->
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-symbols-rounded">notifications</span>
                        <span class="nav-label">Notificações</span>
                    </a>
                </li>

                <!-- Favoritos -->
                <li class="nav-item dropdown-container">
                    <a href="#" class="nav-link dropdown-toggle">
                        <span class="material-symbols-rounded">favorite</span>
                        <span class="nav-label">Favoritos</span>
                        <span class="dropdown-icon material-symbols-rounded">keyboard_arrow_down</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="nav-item"><a class="nav-link dropdown-title">Favoritos</a></li>
                        <li class="nav-item"><a href="#" class="nav-link dropdown-link">
                            <span class="material-symbols-rounded">bookmark</span>
                            <span>Salvos</span>
                        </a></li>
                        <li class="nav-item"><a href="#" class="nav-link dropdown-link">
                            <span class="material-symbols-rounded">history</span>
                            <span>Histórico</span>
                        </a></li>
                    </ul>
                </li>

                <!-- Cadastrar (Apenas para Admin) -->
                <li class="nav-item dropdown-container admin-only" style="display: none;">
                    <a href="#" class="nav-link dropdown-toggle">
                        <span class="material-symbols-rounded">library_add</span>
                        <span class="nav-label">Cadastrar</span>
                        <span class="dropdown-icon material-symbols-rounded">keyboard_arrow_down</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="nav-item"><a class="nav-link dropdown-title">Cadastrar</a></li>
                        <li class="nav-item"><a href="cadastro_prod.html" class="nav-link dropdown-link">
                            <span class="material-symbols-rounded">person_add</span>
                            <span>Novo Produto</span>
                        </a></li>
                        <li class="nav-item"><a href="cadastro_cli.html" class="nav-link dropdown-link">
                            <span class="material-symbols-rounded">person_add</span>
                            <span>Novo Cliente</span>
                        </a></li>
                    </ul>
                </li>

                <!-- Configurações -->
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-symbols-rounded">settings</span>
                        <span class="nav-label">Configurações</span>
                    </a>
                </li>
            </ul>

            <ul class="nav-list secondary-nav">
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-symbols-rounded">help</span>
                        <span class="nav-label">Ajuda</span>
                    </a>
                </li>
                <li class="nav-item" id="user-info">
                    <a href="Login.html" class="nav-link">
                        <span class="material-symbols-rounded">login</span>
                        <span class="nav-label">Entrar</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Conteúdo Principal -->
    <main class="main-content">
        <!-- Cabeçalho -->
        <div class="page-header">
            <h1 class="page-title">Resultados da Pesquisa</h1>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Digite sua pesquisa...">
                <button id="search-button"><span class="material-symbols-rounded">search</span></button>
            </div>
        </div>

        <!-- Filtros -->
        <section class="filters-section">
            <div class="filter-options">
                <select id="sort-select">
                    <option value="recentes">Mais recentes</option>
                    <option value="preco-asc">Preço: menor para maior</option>
                    <option value="preco-desc">Preço: maior para menor</option>
                    <option value="avaliacao">Melhores avaliações</option>
                </select>
                
                <select id="category-filter">
                    <option value="">Todas categorias</option>
                    <option value="maquiagem">Maquiagem</option>
                    <option value="skincare">Skincare</option>
                    <option value="cabelos">Cabelos</option>
                    <option value="perfumes">Perfumes</option>
                    <option value="corpo">Corpo e Banho</option>
                </select>
            </div>
        </section>

        <!-- Resultados -->
        <section class="products-section">
            <div class="products-grid" id="products-container">
                <div class="empty">Digite um termo para pesquisar</div>
            </div>
            
            <div class="pagination">
                <button id="prev-page" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="page-info">Página 1</span>
                <button id="next-page"><i class="fas fa-chevron-right"></i></button>
            </div>
        </section>

        <!-- Rodapé (copie o mesmo da Home.html) -->
        <footer class="footer">
            <!-- ... -->
        </footer>
    </main>

    <!-- Firebase SDK -->
    <script type="module">
        // Configuração do Firebase (igual à Home.html)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where, orderBy, limit, startAfter } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyDeydDlOVXSAIiatAJldHv1OOXQpHAmSUw",
            authDomain: "juciloja.firebaseapp.com",
            projectId: "juciloja",
            storageBucket: "juciloja.appspot.com",
            messagingSenderId: "560206416707",
            appId: "1:560206416707:web:98c7d4ff8bfc3e297bbdf6",
            measurementId: "G-MB1LJDK3G3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Variáveis de estado
        let currentPage = 1;
        const productsPerPage = 8;
        let currentCategory = '';
        let currentSort = 'recentes';
        let currentSearchTerm = '';
        let lastVisibleDoc = null;

        // Elementos do DOM
        const productsContainer = document.getElementById('products-container');
        const prevPageButton = document.getElementById('prev-page');
        const nextPageButton = document.getElementById('next-page');
        const pageInfo = document.getElementById('page-info');
        const sortSelect = document.getElementById('sort-select');
        const categoryFilter = document.getElementById('category-filter');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');

        // Função para carregar produtos com filtros
        async function loadProducts() {
            try {
                productsContainer.innerHTML = '<div class="loader"><i class="fas fa-spinner fa-spin"></i> Carregando produtos...</div>';
                
                let q = query(collection(db, "produtos"));
                
                // Aplicar filtro de busca
                if (currentSearchTerm) {
                    q = query(q, where("nome", ">=", currentSearchTerm),
                              where("nome", "<=", currentSearchTerm + '\uf8ff'));
                }
                
                // Aplicar filtro de categoria
                if (currentCategory) {
                    q = query(q, where("categoria", "==", currentCategory));
                }
                
                // Aplicar ordenação
                switch (currentSort) {
                    case 'recentes':
                        q = query(q, orderBy("dataCadastro", "desc"));
                        break;
                    case 'preco-asc':
                        q = query(q, orderBy("preco", "asc"));
                        break;
                    case 'preco-desc':
                        q = query(q, orderBy("preco", "desc"));
                        break;
                    case 'avaliacao':
                        q = query(q, orderBy("rating", "desc"));
                        break;
                }
                
                // Paginação
                q = query(q, limit(productsPerPage));
                
                if (currentPage > 1 && lastVisibleDoc) {
                    q = query(q, startAfter(lastVisibleDoc));
                }
                
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    productsContainer.innerHTML = '<div class="empty">Nenhum produto encontrado.</div>';
                    return;
                }
                
                // Atualizar último documento visível para paginação
                lastVisibleDoc = querySnapshot.docs[querySnapshot.docs.length - 1];
                
                // Construir HTML dos produtos (igual ao da Home.html)
                let html = '';
                querySnapshot.forEach(doc => {
                    const product = doc.data();
                    html += `
                        <div class="product-card" data-id="${doc.id}">
                            <img src="${product.imagemUrl || 'https://via.placeholder.com/300x200?text=Sem+Imagem'}" 
                                 alt="${product.nome}" class="product-image">
                            <div class="product-info">
                                <h3 class="product-name">${product.nome}</h3>
                                <div class="product-rating">
                                    ${getRatingStars(product.rating || 0)}
                                    <span>(${product.reviews || 0})</span>
                                </div>
                                <p class="product-price">R$ ${product.preco.toFixed(2)}</p>
                                <button class="btn-add-cart" data-id="${doc.id}">
                                    <i class="fas fa-shopping-cart"></i> Adicionar
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                productsContainer.innerHTML = html;
                
                // Atualizar controles de paginação
                updatePaginationControls();
                
                // Adicionar eventos aos botões
                document.querySelectorAll('.btn-add-cart').forEach(button => {
                    button.addEventListener('click', addToCart);
                });
                
            } catch (error) {
                console.error("Erro ao carregar produtos:", error);
                productsContainer.innerHTML = '<div class="error">Erro ao carregar produtos. Por favor, tente novamente.</div>';
            }
        }

        // Funções auxiliares (getRatingStars, updatePaginationControls, addToCart - iguais às da Home.html)

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Se houver parâmetro na URL, carregar pesquisa
            const urlParams = new URLSearchParams(window.location.search);
            const searchParam = urlParams.get('q');
            
            if (searchParam) {
                searchInput.value = searchParam;
                currentSearchTerm = searchParam;
                loadProducts();
            }
            
            // Configurar eventos
            searchButton.addEventListener('click', () => {
                currentSearchTerm = searchInput.value.trim();
                currentPage = 1;
                lastVisibleDoc = null;
                loadProducts();
            });
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    currentSearchTerm = searchInput.value.trim();
                    currentPage = 1;
                    lastVisibleDoc = null;
                    loadProducts();
                }
            });
            
            sortSelect.addEventListener('change', () => {
                currentSort = sortSelect.value;
                currentPage = 1;
                lastVisibleDoc = null;
                loadProducts();
            });
            
            categoryFilter.addEventListener('change', () => {
                currentCategory = categoryFilter.value;
                currentPage = 1;
                lastVisibleDoc = null;
                loadProducts();
            });
            
            // Configurar paginação (igual à Home.html)
            prevPageButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadProducts();
                }
            });
            
            nextPageButton.addEventListener('click', () => {
                currentPage++;
                loadProducts();
            });
        });
    </script>
     <script src="main.js"></script>
</body>
</html>